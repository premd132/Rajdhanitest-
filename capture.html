<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Photo-Style Jodi Pattern (6-Column)</title>
<style>
  body{font-family:Arial;background:#f6f1d3;margin:10px}
  .controls{margin-bottom:8px}
  table{border-collapse:collapse}
  th,td{
    border:1px solid #999;
    width:56px;height:34px;
    text-align:center;
    font-weight:700;
    background:#fbf6db;
    position:relative;
  }
  th{background:#eee}
  td[contenteditable]{outline:none}
  .sq{outline:3px solid #000}
  .ci{border:3px solid #1e5bff;border-radius:50%}
  svg{position:absolute;top:0;left:0;pointer-events:none}
  button{margin-left:6px}
</style>
</head>
<body>

<div class="controls">
  Day:
  <select id="day">
    <option value="0">Mon</option><option value="1">Tue</option>
    <option value="2">Wed</option><option value="3">Thu</option>
    <option value="4">Fri</option><option value="5">Sat</option>
  </select>
  Base Jodi: <input id="base" size="3" value="20">
  Rows:
  <select id="rows"></select>
  <button onclick="search()">SEARCH</button>
  <button onclick="clearMarks()">Clear</button>
</div>

<div class="controls">
  CSV: <input type="file" id="csv">
  <button onclick="upload()">Upload</button>
  <button onclick="addRow()">Add Row</button>
</div>

<div id="wrap" style="position:relative">
  <svg id="lines"></svg>
  <table>
    <thead>
      <tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<script>
// ===== Families (as discussed) =====
const FAMILIES={
"12":["12","17","21","26","62","67","71","76"],
"13":["13","18","31","36","63","68","81","86"],
"14":["14","19","41","46","64","69","91","96"],
"15":["01","06","10","15","51","56","60","65"],
"23":["23","28","32","37","73","78","82","87"],
"24":["24","29","42","47","74","79","92","97"],
"25":["02","07","20","25","52","57","70","75"],
"34":["34","39","43","48","84","89","93","98"],
"35":["03","08","30","35","53","58","80","85"],
"45":["04","09","40","45","54","59","90","95"],
"half":["05","16","27","38","49","50","61","72","83","94"],
"full":["00","11","22","33","44","55","66","77","88","99"]
};

// ===== Utils =====
const pad=v=>{
  if(v==="**") return "**";
  v=String(v).replace(/[^0-9]/g,"");
  if(v==="") return "**";
  return v.length===1?("0"+v):v.slice(-2);
};
const palti=v=>v==="**"?"**":(v[1]+v[0]);
const fam=v=>{for(let k in FAMILIES) if(FAMILIES[k].includes(v)) return k; return null;}
const isRel=(base,v)=>{
  if(v==="**") return false;
  if(v===base) return true;
  if(palti(v)===base) return true;
  const f=fam(base); return f && FAMILIES[f].includes(v);
};

// ===== Data + Storage =====
const KEY="jodi6col";
let data=[];
const tbody=document.getElementById("tbody");
const svg=document.getElementById("lines");

for(let i=1;i<=10;i++){
  const o=document.createElement("option"); o.value=i; o.text=i;
  rows.appendChild(o);
}

function save(){localStorage.setItem(KEY,JSON.stringify(data))}
function load(){
  const s=localStorage.getItem(KEY);
  if(s){data=JSON.parse(s); render();}
}
load();

// ===== CSV Upload (6 columns) =====
function upload(){
  const f=csv.files[0]; if(!f) return alert("CSV select karo");
  const r=new FileReader();
  r.onload=()=>{
    let lines=r.result.replace(/\r/g,"").trim().split("\n");
    if(lines[0].toLowerCase().includes("mon")) lines.shift();
    data=lines.map(l=>{
      const a=l.split(",").map(x=>pad(x.trim()));
      while(a.length<6) a.push("**");
      return a.slice(0,6);
    });
    save(); render();
  };
  r.readAsText(f);
}

// ===== Table =====
function render(){
  tbody.innerHTML="";
  data.forEach((row,ri)=>{
    const tr=document.createElement("tr");
    row.forEach((v,ci)=>{
      const td=document.createElement("td");
      td.textContent=v; td.dataset.r=ri; td.dataset.c=ci;
      td.contentEditable=true;
      td.oninput=()=>{ data[ri][ci]=pad(td.textContent); save(); };
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  resizeSVG();
}
function addRow(){
  data.push(["**","**","**","**","**","**"]);
  save(); render();
}

// ===== Search (photo-style base) =====
function cell(r,c){return document.querySelector(`td[data-r="${r}"][data-c="${c}"]`);}
function markSq(r,c){cell(r,c).classList.add("sq")}
function markCi(r,c){cell(r,c).classList.add("ci")}

function search(){
  clearMarks();
  const basev=pad(base.value);
  const R=parseInt(rows.value);
  const startCol=parseInt(day.value);

  // bottom â†’ top
  for(let r=data.length-1;r>=0;r--){
    for(let c=0;c<6;c++){
      if(data[r][c]===basev){
        markSq(r,c);
        // capture relative moves within R rows (any column)
        const path=[];
        for(let k=1;k<=R;k++){
          const rr=r-k; if(rr<0) break;
          for(let cc=0;cc<6;cc++){
            if(isRel(basev,data[rr][cc])){
              path.push({r:rr,c:cc,dr:k,dc:cc-c});
              markCi(rr,cc);
            }
          }
        }
        // draw same-column links for found path
        drawPath([{r,c},...path.map(p=>({r:p.r,c:p.c}))]);
      }
    }
  }
}

function drawPath(nodes){
  for(let i=0;i<nodes.length-1;i++){
    const a=cell(nodes[i].r,nodes[i].c).getBoundingClientRect();
    const b=cell(nodes[i+1].r,nodes[i+1].c).getBoundingClientRect();
    const box=svg.getBoundingClientRect();
    const l=document.createElementNS("http://www.w3.org/2000/svg","line");
    l.setAttribute("x1",a.left+a.width/2-box.left);
    l.setAttribute("y1",a.top+a.height/2-box.top);
    l.setAttribute("x2",b.left+b.width/2-box.left);
    l.setAttribute("y2",b.top+b.height/2-box.top);
    l.setAttribute("stroke","#1e5bff");
    l.setAttribute("stroke-width","2");
    svg.appendChild(l);
  }
}

// ===== Clear & Resize =====
function clearMarks(){
  document.querySelectorAll(".sq,.ci").forEach(e=>e.classList.remove("sq","ci"));
  svg.innerHTML="";
}
function resizeSVG(){
  const t=document.querySelector("table").getBoundingClientRect();
  svg.setAttribute("width",t.width);
  svg.setAttribute("height",t.height);
}
window.onresize=resizeSVG;
</script>
</body>
</html>
