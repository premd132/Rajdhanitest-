<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalyan Pro - AI Table Logic Master</title>
<style>
    :root { 
        --gold: #ffcc00; --red: #e60000; --bg: #0d0d0d; 
        --panel: #1a1a1a; --border: #333; --green: #00ff41; --white: #ffffff;
    }
    body { font-family: 'Roboto', Arial, sans-serif; background: var(--bg); color: var(--white); margin: 0; padding: 10px; }
    
    h2 { color: var(--gold); text-align: center; text-transform: uppercase; border-bottom: 2px solid var(--gold); display: inline-block; padding: 0 20px 5px; margin: 10px auto; width: 100%; box-sizing: border-box; }
    
    .toolbar { background: var(--panel); padding: 15px; border-radius: 5px; border: 1px solid var(--border); margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
    
    /* DPBoss Style Table */
    .table-container { position: relative; background: #fff; border-radius: 4px; padding: 5px; display: inline-block; border: 2px solid #555; }
    table { border-collapse: collapse; font-size: 14px; color: #000; }
    td, th { border: 1px solid #999; padding: 8px 4px; text-align: center; font-weight: bold; width: 45px; height: 45px; cursor: pointer; }
    th { background: #800000; color: white; font-size: 11px; }
    
    .blank { background: #ffffcc !important; border: 2px dashed var(--red) !important; color: #f00; }
    .circle { border: 2px solid var(--red) !important; border-radius: 50%; background: rgba(255, 0, 0, 0.2); position: relative; z-index: 10; }
    .table-hit { background: #00ff41 !important; color: #000 !important; border-radius: 4px; }
    .base-hit { background: var(--gold) !important; border-radius: 50%; color: #000 !important; border: 2px solid #000; }
    
    .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px; }
    .card { background: var(--panel); padding: 15px; border-radius: 8px; border-top: 3px solid var(--gold); }
    .card h3 { margin: 0 0 10px 0; color: var(--gold); font-size: 14px; text-transform: uppercase; border-bottom: 1px solid #444; padding-bottom: 5px; }
    
    .match-item { background: #262626; padding: 10px; margin-bottom: 8px; border-radius: 4px; cursor: pointer; font-size: 13px; border-left: 3px solid var(--red); transition: 0.3s; }
    .match-item:hover { background: #333; border-left-color: var(--green); }
    
    .prediction-box { font-size: 50px; color: var(--gold); text-align: center; font-weight: bold; padding: 10px; border: 2px dashed #444; margin-top: 10px; border-radius: 10px; text-shadow: 0 0 10px rgba(255,204,0,0.5); }

    canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 5; }
    button { background: var(--gold); color: #000; border: none; padding: 10px 15px; font-weight: bold; border-radius: 4px; cursor: pointer; text-transform: uppercase; font-size: 12px; }
    button:hover { filter: brightness(1.2); }
</style>
</head>
<body>

<h2>üèÜ KALYAN PRO AI MASTER (V11)</h2>

<div class="toolbar">
    <input type="file" id="csv" style="display:none">
    <button onclick="document.getElementById('csv').click()">üìÇ CSV Import</button>
    <button onclick="addRow()">‚ûï Add Row</button>
    <button onclick="saveData()" style="background:var(--green);">üíæ Save</button>
    <button onclick="clearData()" style="background:var(--red); color:#fff;">üóëÔ∏è Reset</button>
</div>

<center>
    <div class="table-container" id="chartArea">
        <canvas id="mainCanvas"></canvas>
        <table id="tbl"></table>
    </div>
</center>

<div class="dashboard">
    <div class="card">
        <h3>üìç Table Matches (DPBoss Logic)</h3>
        <div id="matchList">Select any (**) to scan...</div>
    </div>
    
    <div class="card">
        <h3>ü§ñ AI Analysis Report</h3>
        <div id="aiReport" style="font-size: 13px; line-height: 1.6;">Upload data to start.</div>
    </div>
    
    <div class="card">
        <h3>üîÆ Future AI Jodi</h3>
        <div id="prediction" class="prediction-box">--</div>
    </div>
</div>

<script>
const STORAGE_KEY = "kalyan_v11_pro";
const families = {"12":["12","17","21","26","62","67","71","76"],"13":["13","18","31","36","63","68","81","86"],"14":["14","19","41","46","64","69","91","96"],"15":["01","06","10","15","51","56","60","65"],"23":["23","28","32","37","73","78","82","87"],"24":["24","29","42","47","74","79","92","97"],"25":["02","07","20","25","52","57","70","75"],"34":["34","39","43","48","84","89","93","98"],"35":["03","08","30","35","53","58","80","85"],"45":["04","09","40","45","54","59","90","95"],"HR":["05","16","27","38","49","50","61","72","83","94"],"FR":["00","11","22","33","44","55","66","77","88","99"]};

function getFamily(v){ for(let k in families) if(families[k].includes(v)) return families[k]; return [v]; }
function norm(v){ v=String(v).trim(); if(v=="" || v=="**") return "**"; return v.length==1?"0"+v:v; }

let chartData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
    ["12","46","78","88","88","45"],
    ["05","90","74","06","19","63"],
    ["**","**","**","**","**","**"]
];

let activePattern = null;

function render() {
    let h = "<tr><th>MON</th><th>TUE</th><th>WED</th><th>THU</th><th>FRI</th><th>SAT</th></tr>";
    chartData.forEach((row, ri) => {
        h += "<tr>";
        row.forEach((cell, ci) => {
            let cls = "";
            if(cell == "**") cls = "blank";
            if(activePattern && activePattern.points.some(p => p.r == ri && p.c == ci)) cls += " circle";
            if(activePattern && activePattern.baseR == ri && activePattern.baseC == ci) cls += " base-hit";
            
            h += `<td class="${cls}" contenteditable="${cell!='**'}" oninput="update(${ri},${ci},this)" onclick="${cell=='**'?`runAI(${ri},${ci})`:''}"> ${cell} </td>`;
        });
        h += "</tr>";
    });
    document.getElementById("tbl").innerHTML = h;
    if(activePattern) setTimeout(drawLines, 50);
}

function update(r, c, el) { chartData[r][c] = norm(el.innerText); }
function addRow() { chartData.push(["**","**","**","**","**","**"]); render(); }
function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(chartData)); alert("Data Saved!"); }
function clearData() { if(confirm("Clear Everything?")) { localStorage.clear(); location.reload(); } }

// --- DPBoss AI Logic ---
function runAI(rowIdx, colIdx) {
    let matches = [];
    let baseJodi = "";
    // Table Logic: ‡§ä‡§™‡§∞ ‡§ï‡•Ä ‡§ú‡•ã‡§°‡§º‡•Ä ‡§∏‡•á ‡§¶‡•Ç‡§∞‡•Ä
    for(let i=rowIdx-1; i>=0; i--) { if(chartData[i][colIdx] != "**") { baseJodi = chartData[i][colIdx]; break; } }
    if(!baseJodi) return;

    let baseFam = getFamily(baseJodi);

    for(let i=0; i < rowIdx - 1; i++) {
        // Table Trick: Same column/day relation
        if(baseFam.includes(chartData[i][colIdx])) {
            let score = 0;
            let pts = [{r: i, c: colIdx}];
            
            // Cross Check Logic
            if(chartData[i-1] && chartData[rowIdx-1]) {
                if(getFamily(chartData[rowIdx-1][colIdx]).includes(chartData[i-1][colIdx])) { score += 2; pts.push({r: i-1, c: colIdx}); }
            }
            matches.push({index: i, score: score, points: pts, baseR: i, baseC: colIdx});
        }
    }
    displayMatches(matches, colIdx);
}

function displayMatches(matches, targetCol) {
    let list = document.getElementById("matchList");
    list.innerHTML = "";
    matches.sort((a,b) => b.score - a.score).slice(0, 5).forEach(m => {
        let div = document.createElement("div");
        div.className = "match-item";
        div.innerHTML = `Table Match at Row ${m.index + 1} (Score: ${m.score})`;
        div.onclick = () => {
            activePattern = m;
            render();
            let pred = chartData[m.index + 1] ? chartData[m.index + 1][targetCol] : "--";
            document.getElementById("prediction").innerText = pred;
            document.getElementById("aiReport").innerHTML = `Found a Table-Cross connection from row ${m.index+1}. This jodi matches the distance of your current base jodi.`;
        };
        list.appendChild(div);
    });
}

function drawLines() {
    const cvs = document.getElementById("mainCanvas");
    const tbl = document.getElementById("tbl");
    const ctx = cvs.getContext("2d");
    cvs.width = tbl.offsetWidth; cvs.height = tbl.offsetHeight;
    ctx.clearRect(0,0,cvs.width,cvs.height);
    
    let rect = tbl.getBoundingClientRect();
    let targets = document.querySelectorAll(".circle, .base-hit");
    if(targets.length < 2) return;
    
    ctx.strokeStyle = "rgba(255, 204, 0, 0.7)";
    ctx.lineWidth = 2;
    let base = document.querySelector(".base-hit").getBoundingClientRect();

    targets.forEach(t => {
        let r = t.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(base.left - rect.left + base.width/2, base.top - rect.top + base.height/2);
        ctx.lineTo(r.left - rect.left + r.width/2, r.top - rect.top + r.height/2);
        ctx.stroke();
    });
}

document.getElementById("csv").onchange = e => {
    let fr = new FileReader();
    fr.onload = () => {
        let lines = fr.result.split('\n');
        chartData = lines.filter(l=>l.trim()).map(l => l.replace(/\./g, ',').split(',').map(v => norm(v.trim())));
        render();
    };
    fr.readAsText(e.target.files[0]);
};

render();
</script>
</body>
</html>
