<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kalyan Pro ‚Äì AI Pattern System</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #ffd700;
            --blue-mark: #3b82f6; /* Blue for circles */
            --green-line: #2ecc71; /* Green for connection lines */
            --bg: #0f172a;
            --panel: #1e293b;
            --text: #f8fafc;
        }

        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); overflow-x: hidden; width: 100vw; height: 100vh; }

        /* --- UI COMPONENTS --- */
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; text-transform: uppercase; font-size: 13px; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4); }

        /* --- PAGES --- */
        #home-page, #auth-page, #dashboard-page {
            min-height: 100vh; display: none; padding: 15px; flex-direction: column; align-items: center; justify-content: center; width: 100%;
        }

        /* --- HOME PAGE --- */
        .hero { text-align: center; max-width: 600px; animation: fadeIn 1s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .hero h1 { font-size: 2.5rem; margin-bottom: 5px; background: linear-gradient(to right, #ffd700, #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1.2; }
        
        /* --- AUTH CARD --- */
        .auth-card { width: 100%; max-width: 350px; padding: 25px; text-align: center; }
        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: #fff; margin-bottom: 12px; }

        /* --- DASHBOARD & TABLE --- */
        .dashboard-container { width: 100%; max-width: 100%; display: flex; flex-direction: column; gap: 10px; }
        .table-wrapper { 
            overflow: hidden; background: #fff; border-radius: 8px; padding: 5px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); position: relative; width: 100%;
        }
        table { border-collapse: collapse; color: #000; width: 100%; table-layout: fixed; }
        td, th { border: 1px solid #cbd5e1; padding: 6px 2px; text-align: center; font-weight: bold; font-size: 13px; height: 38px; }
        th { background: #1e293b; color: white; font-size: 10px; }
        
        /* Blue Circle Marking */
        .circle { 
            background: rgba(59, 130, 246, 0.2); 
            border: 2.5px solid var(--blue-mark) !important; 
            border-radius: 50% !important; 
        }

        .ai-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; }
        .stat-card { padding: 10px; border-left: 3px solid var(--gold); }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 11px; color: var(--gold); opacity: 0.8; }
        .stat-card div { font-size: 12px; font-weight: 600; }

        /* Hidden Admin */
        #admin-panel { position: fixed; bottom: 10px; right: 10px; z-index: 1000; display: none; padding: 15px; border: 1px solid var(--gold); width: 250px; }

        canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 2; }
    </style>
</head>
<body onload="checkUserStatus()">

    <div id="home-page" style="display: flex;">
        <div class="hero">
            <div style="font-size: 4rem; margin-bottom: 10px;">üèÜ</div>
            <h1>KALYAN AI <br><span style="color: var(--gold); font-size: 1.5rem;">PATTERN PRO</span></h1>
            <p style="opacity: 0.7; font-size: 14px;">Smart Pattern Analysis for Expert Result Prediction</p>
            <div style="margin-top: 30px; display: flex; flex-direction: column; gap: 10px;">
                <button class="btn btn-gold" onclick="showAuth('signup')">Create Account</button>
                <button class="btn" style="color: var(--gold); border: 1px solid var(--gold);" onclick="showAuth('login')">Sign In</button>
            </div>
        </div>
    </div>

    <div id="auth-page">
        <div class="glass auth-card">
            <h2 id="auth-title" style="margin-top: 0; color: var(--gold);">Account</h2>
            <input type="tel" id="user-mobile" placeholder="Mobile Number">
            <input type="password" id="user-pwd" placeholder="Password">
            <p id="status-msg" style="font-size: 11px; color: var(--gold); min-height: 15px;"></p>
            <button class="btn btn-gold" style="width: 100%;" onclick="handleAuth()">Submit</button>
            <p onclick="toggleAuth()" style="cursor:pointer; margin-top:15px; font-size: 12px; opacity: 0.6;">Switch Login / Signup</p>
        </div>
    </div>

    <div id="dashboard-page">
        <div class="dashboard-container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--gold); font-weight: 800; font-size: 14px;">ANALYSIS HUB</span>
                <button onclick="logout()" style="background:none; border:none; color:#ff4444; font-size: 12px; font-weight: bold;">LOGOUT</button>
            </div>

            <div class="table-wrapper">
                <canvas id="mainCanvas"></canvas>
                <table id="tbl"></table>
            </div>

            <div class="ai-stats">
                <div class="glass stat-card" style="grid-column: span 2;">
                    <h3>‚úî RECENT MATCHES</h3>
                    <div id="checks" style="max-height: 60px; overflow-y: auto;">-</div>
                </div>
                <div class="glass stat-card">
                    <h3>ü§ñ AI LOGIC</h3>
                    <div id="ai">-</div>
                </div>
                <div class="glass stat-card">
                    <h3>üîÆ FUTURE</h3>
                    <div id="future" style="color: #00ff00;">-</div>
                </div>
            </div>

            <div style="display: flex; gap: 5px; margin-top: 5px;">
                <button class="btn btn-gold" style="flex:1; font-size: 11px;" onclick="addRow()">+ Row</button>
                <button class="btn" style="flex:1; font-size: 11px; background:#28a745; color:#fff;" onclick="saveData()">Save</button>
                <button class="btn" style="flex:1; font-size: 11px; background:#dc3545; color:#fff;" onclick="clearData()">Clear</button>
            </div>
        </div>
    </div>

    <div id="admin-panel" class="glass">
        <h4 style="margin:0 0 10px 0;">Pending Approvals</h4>
        <div id="pending-list" style="font-size: 12px;"></div>
        <button class="btn btn-gold" style="width:100%; margin-top:10px; padding:5px;" onclick="document.getElementById('admin-panel').style.display='none'">Close</button>
    </div>

    <script>
        // --- AUTH & ADMIN LOGIC ---
        function checkUserStatus() {
            if(localStorage.getItem('session')) {
                document.getElementById('home-page').style.display = 'none';
                document.getElementById('auth-page').style.display = 'none';
                document.getElementById('dashboard-page').style.display = 'flex';
                draw();
            }
        }

        let authMode = 'signup';
        function showAuth(m) { 
            authMode = m; 
            document.getElementById('home-page').style.display='none'; 
            document.getElementById('auth-page').style.display='flex';
            document.getElementById('auth-title').innerText = m === 'signup' ? 'Create Account' : 'Welcome Back';
        }
        function toggleAuth() { showAuth(authMode === 'signup' ? 'login' : 'signup'); }

        function handleAuth() {
            const mob = document.getElementById('user-mobile').value;
            if(mob.length < 10) return alert("Valid Mobile required");
            if(authMode === 'signup') {
                localStorage.setItem('u_'+mob, 'pending');
                document.getElementById('status-msg').innerText = "Request Sent! Ask admin to approve.";
            } else {
                const s = localStorage.getItem('u_'+mob);
                if(s === 'approved') { localStorage.setItem('session', mob); checkUserStatus(); }
                else alert(s === 'pending' ? "Wait for Admin Approval" : "User not found");
            }
        }
        function logout() { localStorage.removeItem('session'); location.reload(); }

        // Hidden Admin: Press Shift + A
        window.addEventListener('keydown', (e) => {
            if(e.shiftKey && e.key === 'A') {
                document.getElementById('admin-panel').style.display = 'block';
                const list = document.getElementById('pending-list');
                list.innerHTML = "";
                for(let i=0; i<localStorage.length; i++) {
                    let k = localStorage.key(i);
                    if(k.startsWith('u_')) {
                        let m = k.split('_')[1];
                        let status = localStorage.getItem(k);
                        list.innerHTML += `<div>${m} - <button onclick="approve('${m}')">${status}</button></div>`;
                    }
                }
            }
        });
        function approve(m) { localStorage.setItem('u_'+m, 'approved'); alert("Approved!"); }

        // --- CORE LOGIC (Blue Circles & Green Lines) ---
        const STORAGE_KEY="pdata_kalyan_v2";
        const families={"12":["12","17","21","26","62","67","71","76"],"13":["13","18","31","36","63","68","81","86"],"14":["14","19","41","46","64","69","91","96"],"15":["01","06","10","15","51","56","60","65"],"23":["23","28","32","37","73","78","82","87"],"24":["24","29","42","47","74","79","92","97"],"25":["02","07","20","25","52","57","70","75"],"34":["34","39","43","48","84","89","93","98"],"35":["03","08","30","35","53","58","80","85"],"45":["04","09","40","45","54","59","90","95"],"HR":["05","16","27","38","49","50","61","72","83","94"],"FR":["00","11","22","33","44","55","66","77","88","99"]};
        function fam(v){for(let k in families) if(families[k].includes(v)) return k; return "NA";}
        function palti(v){return v[1]+v[0];}
        function norm(v){if(v==""||v=="**")return "**"; v=String(v); return v.length==1?"0"+v:v;}
        function smartMatch(a,b){ if(a=="**"||b=="**") return false; return a===b || palti(a)===b || fam(a)===fam(b); }

        let data=JSON.parse(localStorage.getItem(STORAGE_KEY)) || [["51","91","41","57","19","95"],["05","90","74","06","19","63"],["90","34","82","09","28","19"],["**","**","**","**","**","**"]];
        data = data.map(r => r.map(norm));

        let activeMark=null;
        function draw(){
            let h="<tr><th>MON</th><th>TUE</th><th>WED</th><th>THU</th><th>FRI</th><th>SAT</th></tr>";
            data.forEach((r,ri)=>{
                h+="<tr>";
                r.forEach((c,ci)=>{
                    let cls = (activeMark && isPartOfPattern(ri, ci)) ? "circle" : "";
                    h+=`<td class="${cls}" contenteditable oninput="edit(${ri},${ci},this)" onclick="${c=='**'?'makePattern('+ri+','+ci+')':'' }">${c}</td>`;
                });
                h+="</tr>";
            });
            document.getElementById("tbl").innerHTML=h;
            if(activeMark) setTimeout(() => drawLines("mainCanvas", document.getElementById("tbl")), 50);
        }

        function isPartOfPattern(ri, ci){
            if(!activeMark) return false;
            let i = ri - activeMark.start;
            return (i >= 0 && i < activeMark.shape.length && activeMark.shape[i][ci]);
        }

        function drawLines(cvsId, tblEl) {
            const cvs = document.getElementById(cvsId);
            const ctx = cvs.getContext("2d");
            cvs.width = tblEl.offsetWidth; cvs.height = tblEl.offsetHeight;
            ctx.clearRect(0,0,cvs.width,cvs.height);
            const cells = tblEl.querySelectorAll(".circle");
            if(cells.length < 2) return;
            const tRect = tblEl.getBoundingClientRect();
            
            ctx.strokeStyle = "#2ecc71"; // Green Connection Line
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            cells.forEach((c, i) => {
                const r = c.getBoundingClientRect();
                const x = r.left - tRect.left + r.width/2;
                const y = r.top - tRect.top + r.height/2;
                if(i === 0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            });
            ctx.stroke();
        }

        function edit(r,c,el){ data[r][c]=norm(el.innerText.trim()); }
        function addRow(){ data.push(["**","**","**","**","**","**"]); draw(); }
        function saveData(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(data)); alert("Saved!"); }
        function clearData(){ if(confirm("Clear?")){ localStorage.removeItem(STORAGE_KEY); location.reload(); }}

        function makePattern(r,c){
            let targetCol=c; let base="**";
            for(let i=r;i>=0;i--){ if(data[i][c]!="**"){base=data[i][c]; break;}}
            if(base=="**") return;
            let shape=[];
            for(let i=Math.max(0,r-3);i<=r;i++){
                let row=[];
                for(let j=0;j<6;j++){ row.push(data[i][j]!="**" && smartMatch(data[i][j],base)?1:0); }
                shape.push(row);
            }
            // Search
            let lastMatches=[];
            for(let i=0; i<=data.length-shape.length; i++){
                let ok=true;
                for(let k=0; k<shape.length; k++){
                    for(let j=0; j<6; j++){ if(shape[k][j] && !smartMatch(data[i+k][j],base)){ok=false; break;}}
                    if(!ok) break;
                }
                if(ok) lastMatches.push({index:i});
            }
            if(lastMatches.length > 0) {
                activeMark = {start: lastMatches[0].index, shape: shape};
                draw();
                // Update Stats
                document.getElementById("ai").innerText = "Jodi: " + base;
                document.getElementById("checks").innerText = "Found " + lastMatches.length + " Patterns";
            }
        }
    </script>
</body>
</html>
