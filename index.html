<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Jodi System – Foundation</title>

<style>
body{font-family:Arial;background:#f4f6f8}
h2{text-align:center}
.panel{background:#fff;padding:10px;margin:10px;border-radius:6px}
label{margin-right:6px}
select,input{margin-right:10px;padding:4px}
table{border-collapse:collapse;width:100%;font-size:13px}
td{border:1px solid #999;padding:6px;text-align:center;min-width:42px}
td[contenteditable]{background:#fffbe6}
.blank{background:#eee}
</style>
</head>

<body>

<h2>Jodi Pattern – Foundation</h2>

<!-- SEARCH OPTIONS -->
<div class="panel">
<label>Market:</label>
<select id="market">
  <option>Kalyan</option>
  <option>Rajdhani</option>
  <option>Milan</option>
</select>

<label>Day:</label>
<select id="day">
  <option>Mon</option><option>Tue</option><option>Wed</option>
  <option>Thu</option><option>Fri</option><option>Sat</option>
</select>

<br><br>

<label>Jodi 1:</label><input id="j1" maxlength="2" style="width:50px">
<label>Jodi 2:</label><input id="j2" maxlength="2" style="width:50px">
<label>Jodi 3:</label><input id="j3" maxlength="2" style="width:50px">

<br><br>

<label>Game Type:</label>
<select disabled>
  <option>Straight</option>
</select>

<label>Top Rows:</label>
<select id="top"></select>

<label>Bottom Rows:</label>
<select id="bottom"></select>

<button>SEARCH</button>
</div>

<!-- CSV -->
<div class="panel">
CSV Upload:
<input type="file" id="csv">
<button onclick="loadCSV()">Upload</button>
<button onclick="addRow()">Add Row</button>
<button onclick="clearAll()">Clear Data</button>
</div>

<!-- TABLE -->
<div class="panel">
<table id="chart"><tbody></tbody></table>
</div>

<script>
/* ---------- INIT ---------- */
for(let i=1;i<=10;i++){
  top.innerHTML+=`<option>${i}</option>`;
  bottom.innerHTML+=`<option>${i}</option>`;
}

let data = JSON.parse(localStorage.getItem("jodiData")) || [];

/* ---------- NORMALIZE JODI ---------- */
function norm(v){
  if(v===undefined || v===null) return "**";
  v=String(v).trim();
  if(v===""||v==="*"||v==="**") return "**";
  v=v.replace(/[^0-9]/g,"");
  if(v==="") return "**";
  if(v.length===1) return "0"+v;
  if(v.length>2) return v.slice(-2);
  return v;
}

/* ---------- TABLE ---------- */
function drawTable(){
  let t=document.querySelector("#chart tbody");
  t.innerHTML="";
  data.forEach((row,ri)=>{
    let tr=document.createElement("tr");
    row.forEach((cell,ci)=>{
      let td=document.createElement("td");
      td.textContent=cell;
      td.contentEditable=true;
      if(cell==="**") td.classList.add("blank");
      td.oninput=()=>{
        data[ri][ci]=norm(td.textContent);
        save();
        drawTable();
      };
      tr.appendChild(td);
    });
    t.appendChild(tr);
  });
}

function save(){
  localStorage.setItem("jodiData",JSON.stringify(data));
}

/* ---------- CSV UPLOAD ---------- */
function loadCSV(){
  let f=csv.files[0];
  if(!f) return;
  let reader=new FileReader();
  reader.onload=e=>{
    let lines=e.target.result.replace(/\r/g,"").split("\n").filter(l=>l.trim());
    data=[];
    lines.forEach(line=>{
      let cols=line.includes(",")?line.split(","):line.split(".");
      data.push(cols.map(v=>norm(v)));
    });
    save();
    drawTable();
  };
  reader.readAsText(f);
}

/* ---------- ADD ROW ---------- */
function addRow(){
  if(data.length===0) return;
  let cols=data[0].length;
  let row=[];
  for(let i=0;i<cols;i++) row.push("**");
  data.push(row);
  save();
  drawTable();
}

/* ---------- CLEAR ---------- */
function clearAll(){
  if(confirm("Clear all data?")){
    data=[];
    localStorage.removeItem("jodiData");
    drawTable();
  }
}

drawTable();
</script>

</body>
</html>
