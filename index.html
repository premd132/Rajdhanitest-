<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalyan Master AI - Professional Pattern System</title>
<style>
    :root { 
        --primary: #800000; --gold: #ffcc00; --bg: #121212; 
        --panel: #1e1e1e; --text: #ffffff; --green: #00ff41; 
    }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
    
    .site-header { text-align: center; border-bottom: 3px solid var(--gold); padding: 10px; margin-bottom: 20px; background: var(--panel); }
    .site-header h1 { margin: 0; color: var(--gold); text-transform: uppercase; font-size: 22px; letter-spacing: 2px; }

    .menu-bar { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; flex-wrap: wrap; }
    
    /* DPBoss Style Table Logic */
    .chart-wrapper { position: relative; display: inline-block; background: #fff; padding: 5px; border: 2px solid #555; border-radius: 4px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    table { border-collapse: collapse; font-size: 14px; color: #000; font-weight: bold; }
    td, th { border: 1px solid #999; width: 42px; height: 42px; text-align: center; cursor: pointer; position: relative; }
    th { background: var(--primary); color: #fff; font-size: 11px; }
    
    .blank { background: #fffde6 !important; border: 2px dashed #ff0000 !important; }
    .marked { border: 2px solid #ff0000 !important; border-radius: 50%; background: rgba(255,0,0,0.15); z-index: 10; position: relative; }
    .base-point { background: var(--gold) !important; border-radius: 50%; color: #000 !important; box-shadow: 0 0 8px var(--gold); }

    /* Dashboard Logic */
    .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; }
    .card { background: var(--panel); padding: 15px; border-radius: 8px; border-left: 5px solid var(--gold); }
    .card h3 { color: var(--gold); margin: 0 0 10px 0; font-size: 15px; border-bottom: 1px solid #444; }

    #match-results { max-height: 150px; overflow-y: auto; }
    .match-btn { background: #333; padding: 10px; margin: 5px 0; border-radius: 4px; cursor: pointer; font-size: 13px; transition: 0.3s; border-left: 3px solid transparent; }
    .match-btn:hover { background: #444; border-left-color: var(--green); }
    .strong-tag { color: var(--green); font-weight: bold; font-size: 10px; border: 1px solid var(--green); padding: 1px 4px; border-radius: 3px; margin-left: 10px; }

    .prediction-value { font-size: 50px; color: var(--gold); text-align: center; font-weight: bold; margin-top: 10px; }

    canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 5; }
    button { background: var(--gold); color: #000; border: none; padding: 10px 15px; font-weight: bold; border-radius: 4px; cursor: pointer; text-transform: uppercase; }
</style>
</head>
<body>

<div class="site-header">
    <h1>KALYAN MASTER AI (V12)</h1>
</div>

<div class="menu-bar">
    <input type="file" id="csv-file" style="display:none" accept=".csv,.txt">
    <button onclick="document.getElementById('csv-file').click()">üìÇ CSV Import</button>
    <button onclick="addRow()">‚ûï Add Row</button>
    <button onclick="saveChart()" style="background:var(--green)">üíæ Save Chart</button>
    <button onclick="resetChart()" style="background:#ff3e3e; color:#fff;">üóëÔ∏è Reset</button>
</div>

<center>
    <div class="chart-wrapper">
        <canvas id="lineCanvas"></canvas>
        <table id="mainChart"></table>
    </div>
</center>

<div class="dashboard">
    <div class="card">
        <h3>üìç DPBoss Style Table Matches</h3>
        <div id="match-results">Click on (**) to scan history...</div>
    </div>
    
    <div class="card">
        <h3>ü§ñ AI Analysis Result</h3>
        <div id="ai-status" style="font-size: 13px; color: #ccc;">Select a blank box to analyze connections.</div>
    </div>
    
    <div class="card">
        <h3>üîÆ Strong Future Jodi</h3>
        <div id="future-jodi" class="prediction-value">--</div>
    </div>
</div>

<script>
const DB_KEY = "kalyan_master_v12";
const rashiMap = {'1':'6','6':'1','2':'7','7':'2','3':'8','8':'3','4':'9','9':'4','5':'0','0':'5'};

function getFamily(j) {
    if(!j || j=="**") return [];
    let a=j[0], b=j[1], ra=rashiMap[a], rb=rashiMap[b];
    return [a+b, b+a, a+rb, ra+b, ra+rb, rb+ra, b+ra, rb+a];
}

let chart = JSON.parse(localStorage.getItem(DB_KEY)) || [
    ["12","46","78","88","88","45"],
    ["05","90","74","06","19","63"],
    ["**","**","**","**","**","**"]
];

let activePattern = null;

function render() {
    let html = "<tr><th>MON</th><th>TUE</th><th>WED</th><th>THU</th><th>FRI</th><th>SAT</th></tr>";
    chart.forEach((row, ri) => {
        html += "<tr>";
        row.forEach((val, ci) => {
            let cls = (val == "**") ? "blank" : "";
            if(activePattern && activePattern.points.some(p => p.r == ri && p.c == ci)) cls += " marked";
            if(activePattern && activePattern.baseR == ri && activePattern.baseC == ci) cls += " base-point";
            
            html += `<td class="${cls}" contenteditable="${val!='**'}" oninput="editCell(${ri},${ci},this)" onclick="${val=='**'?`runDPBossLogic(${ri},${ci})`:''}"> ${val} </td>`;
        });
        html += "</tr>";
    });
    document.getElementById("mainChart").innerHTML = html;
    if(activePattern) setTimeout(drawConnections, 50);
}

function runDPBossLogic(r, c) {
    let baseJodi = ""; let bRow = -1;
    for(let i=r-1; i>=0; i--) { if(chart[i][c] != "**") { baseJodi=chart[i][c]; bRow=i; break; } }
    if(bRow == -1) return;

    let matches = [];
    let fam = getFamily(baseJodi);

    for(let i=0; i < r - 1; i++) {
        // Table Trick: Checking Same Column & Same Day pattern
        if(fam.includes(chart[i][c])) {
            let score = 0; let pts = [{r: i, c: c}];
            // Cross Logic (Checking neighboring cells)
            if(chart[i-1] && chart[r-1] && getFamily(chart[r-1][c]).includes(chart[i-1][c])) {
                score += 5; pts.push({r: i-1, c: c});
            }
            matches.push({index: i, score: score, points: pts, baseR: i, baseC: c});
        }
    }
    displayMatches(matches, c);
}

function displayMatches(matches, col) {
    let res = document.getElementById("match-results");
    res.innerHTML = "";
    matches.sort((a,b) => b.score - a.score).slice(0, 6).forEach(m => {
        let div = document.createElement("div");
        div.className = "match-btn";
        div.innerHTML = `Match at Row ${m.index + 1} (Score: ${m.score}) ${m.score >= 5 ? '<span class="strong-tag">STRONG</span>' : ''}`;
        div.onclick = () => {
            activePattern = m;
            render();
            let nextVal = chart[m.index + 1] ? chart[m.index + 1][col] : "??";
            document.getElementById("future-jodi").innerText = nextVal;
            document.getElementById("ai-status").innerText = `Found a confirmed ${m.score >= 5 ? 'Strong' : 'Normal'} Table Trick connection.`;
        };
        res.appendChild(div);
    });
}

function drawConnections() {
    const cvs = document.getElementById("lineCanvas");
    const tbl = document.getElementById("mainChart");
    const ctx = cvs.getContext("2d");
    cvs.width = tbl.offsetWidth; cvs.height = tbl.offsetHeight;
    ctx.clearRect(0,0,cvs.width,cvs.height);
    
    let rect = tbl.getBoundingClientRect();
    let targets = document.querySelectorAll(".marked, .base-point");
    if(targets.length < 2) return;
    
    ctx.strokeStyle = "rgba(255, 204, 0, 0.7)";
    ctx.lineWidth = 2;
    let base = document.querySelector(".base-point").getBoundingClientRect();

    targets.forEach(t => {
        let r = t.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(base.left - rect.left + base.width/2, base.top - rect.top + base.height/2);
        ctx.lineTo(r.left - rect.left + r.width/2, r.top - rect.top + r.height/2);
        ctx.stroke();
    });
}

function editCell(r, c, el) { chart[r][c] = el.innerText.trim(); }
function addRow() { chart.push(["**","**","**","**","**","**"]); render(); }
function saveChart() { localStorage.setItem(DB_KEY, JSON.stringify(chart)); alert("Chart Saved!"); }
function resetChart() { if(confirm("Are you sure?")) { localStorage.clear(); location.reload(); } }

document.getElementById("csv-file").onchange = e => {
    let fr = new FileReader();
    fr.onload = () => {
        chart = fr.result.split('\n').filter(l=>l.trim()).map(l => l.replace(/\./g, ',').split(',').map(v => v.trim()));
        render();
    };
    fr.readAsText(e.target.files[0]);
};

render();
</script>
</body>
</html>
