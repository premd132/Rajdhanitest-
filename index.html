<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalyan AI Pattern Master - Pro</title>
<style>
    :root { 
        --gold: #ffcc00; --red: #ff3131; --bg: #0b0c10; 
        --panel: #1f2833; --text: #c5c6c7; --green: #00ff41;
    }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
    
    .header { text-align: center; margin-bottom: 20px; }
    .header h1 { color: var(--gold); margin: 0; font-size: 24px; text-transform: uppercase; letter-spacing: 2px; }
    
    .toolbar { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; background: var(--panel); padding: 15px; border-radius: 12px; border: 1px solid #45a29e; }
    
    /* Premium Table Design */
    .table-container { position: relative; background: #fff; border-radius: 10px; padding: 10px; box-shadow: 0 0 30px rgba(102, 252, 241, 0.2); display: inline-block; }
    table { border-collapse: collapse; color: #000; font-weight: bold; }
    td, th { border: 1.5px solid #dee2e6; width: 45px; height: 45px; text-align: center; position: relative; }
    th { background: #1f2833; color: var(--gold); font-size: 11px; }
    
    .blank { background: #fdf2e9 !important; border: 2px dashed var(--red) !important; cursor: pointer; }
    .circle { background: var(--red) !important; color: #fff !important; border-radius: 50%; box-shadow: 0 0 10px var(--red); z-index: 5; }
    .base-mark { background: var(--gold) !important; color: #000 !important; border-radius: 50%; border: 2px solid #000; }

    /* UI Components */
    .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 25px; }
    .card { background: var(--panel); padding: 20px; border-radius: 15px; border-top: 4px solid var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .card h3 { color: var(--gold); margin-top: 0; border-bottom: 1px solid #45a29e; padding-bottom: 10px; font-size: 16px; }
    
    .match-item { background: #0b0c10; border: 1px solid #45a29e; margin: 8px 0; padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.3s; }
    .match-item:hover { transform: scale(1.02); border-color: var(--gold); }
    .strong-tag { color: var(--green); font-weight: bold; float: right; font-size: 10px; text-transform: uppercase; }

    .prediction-value { font-size: 48px; font-weight: bold; color: var(--gold); text-align: center; text-shadow: 0 0 15px rgba(255, 204, 0, 0.5); }
    
    canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 4; }
    button { background: var(--gold); color: #000; border: none; padding: 10px 20px; font-weight: bold; border-radius: 6px; cursor: pointer; }
    #csvInput { display: none; }
</style>
</head>
<body>

<div class="header">
    <h1>üéØ AI Pattern Master Pro</h1>
</div>

<div class="toolbar">
    <button onclick="document.getElementById('csvInput').click()">üìÇ ‡§≤‡•ã‡§° CSV</button>
    <input type="file" id="csvInput">
    <button onclick="addRow()">‚ûï ‡§∞‡•ã ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
    <button onclick="saveData()" style="background: var(--green);">üíæ ‡§∏‡•á‡§µ ‡§ö‡§æ‡§∞‡•ç‡§ü</button>
    <button onclick="clearData()" style="background: var(--red); color: #fff;">üóëÔ∏è ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞</button>
</div>

<center>
    <div class="table-container" id="mainWrap">
        <canvas id="mainCanvas"></canvas>
        <table id="tbl"></table>
    </div>
</center>

<div class="dashboard">
    <div class="card">
        <h3>üìç ‡§∏‡§ü‡•Ä‡§ï ‡§Æ‡•à‡§ö‡§ø‡§Ç‡§ó (Matches)</h3>
        <div id="checks">‡§ñ‡§æ‡§≤‡•Ä ‡§¨‡•â‡§ï‡•ç‡§∏ (**) ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...</div>
    </div>
    
    <div class="card">
        <h3>üîÆ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä (Strong Prediction)</h3>
        <div id="result" class="prediction-value">--</div>
        <div id="status" style="text-align: center; color: var(--green); font-weight: bold; font-size: 12px;"></div>
    </div>
</div>

<script>
const rashi = {'1':'6','6':'1','2':'7','7':'2','3':'8','8':'3','4':'9','9':'4','5':'0','0':'5'};
function getFamily(jodi) {
    if(!jodi || jodi=="**") return [];
    let a=jodi[0], b=jodi[1];
    let ra=rashi[a], rb=rashi[b];
    return [a+b, b+a, a+rb, ra+b, ra+rb, rb+ra, b+ra, rb+a];
}

let data = JSON.parse(localStorage.getItem("kalyan_pro_v3")) || [
    ["12","46","78","88","88","45"],
    ["33","19","90","05","12","67"],
    ["**","**","**","**","**","**"]
];

let activePattern = null;
let currentTargetCol = null;

function render(){
    let h="<tr><th>‡§∏‡•ã‡§Æ</th><th>‡§Æ‡§Ç‡§ó‡§≤</th><th>‡§¨‡•Å‡§ß</th><th>‡§ó‡•Å‡§∞‡•Å</th><th>‡§∂‡•Å‡§ï‡•ç‡§∞</th><th>‡§∂‡§®‡§ø</th></tr>";
    data.forEach((r, ri) => {
        h += "<tr>";
        r.forEach((c, ci) => {
            let cls = "";
            if(c=="**") cls = "blank";
            if(activePattern && activePattern.points.some(p=>p.r==ri && p.c==ci)) cls = "circle";
            if(activePattern && activePattern.base.r==ri && activePattern.base.c==ci) cls = "base-mark";
            h += `<td class="${cls}" contenteditable="${c!='**'}" oninput="edit(${ri},${ci},this)" onclick="${c=='**'?'analyze('+ri+','+ci+')':'' }">${c}</td>`;
        });
        h += "</tr>";
    });
    document.getElementById("tbl").innerHTML = h;
    if(activePattern) setTimeout(drawPatternLines, 50);
}

function analyze(r, c){
    currentTargetCol = c;
    let baseJodi = "";
    // ‡§Ö‡§™‡§®‡•á ‡§ï‡•â‡§≤‡§Æ ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§®‡§ú‡§¶‡•Ä‡§ï‡•Ä ‡§ä‡§™‡§∞ ‡§µ‡§æ‡§≤‡•Ä ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ï‡•ã "Base" ‡§Æ‡§æ‡§®‡•á‡§Ç
    for(let i=r-1; i>=0; i--){ if(data[i][c]!="**"){ baseJodi=data[i][c]; break; } }
    if(!baseJodi) return;

    let matches = [];
    let baseFam = getFamily(baseJodi);

    // ‡§™‡•Ç‡§∞‡•á ‡§ö‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç
    for(let i=1; i < data.length - 1; i++){
        // "SAME DAY SAME COLUMN" Logic:
        // ‡§Ö‡§ó‡§∞ ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§â‡§∏‡•Ä ‡§¶‡§ø‡§®/‡§ï‡•â‡§≤‡§Æ ‡§Æ‡•á‡§Ç ‡§¨‡•á‡§∏ ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§´‡•à‡§Æ‡§ø‡§≤‡•Ä ‡§Æ‡§ø‡§≤‡§§‡•Ä ‡§π‡•à
        if(baseFam.includes(data[i][c])){
            let score = 0;
            let pPoints = [];
            // ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§ï‡•á 2 ‡§π‡§´‡§º‡•ç‡§§‡•ã‡§Ç ‡§ï‡§æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç
            for(let rowOff=-2; rowOff<=0; rowOff++){
                for(let colOff=-2; colOff<=2; colOff++){
                    let currR = r + rowOff, currC = c + colOff;
                    let histR = i + rowOff, histC = c + colOff;
                    if(data[currR] && data[histR] && data[currR][currC]!="**" && 
                       getFamily(data[currR][currC]).includes(data[histR][histC])){
                        score++;
                        pPoints.push({r: histR, c: histC});
                    }
                }
            }
            if(score >= 2) matches.push({index: i, score: score, points: pPoints, base: {r:i, c:c}});
        }
    }
    showMatches(matches, r, c);
}

function showMatches(matches, targetR, targetC){
    let div = document.getElementById("checks");
    div.innerHTML = "";
    matches.sort((a,b)=>b.score - a.score).forEach(m => {
        let item = document.createElement("div");
        item.className = "match-item";
        let isStrong = m.score >= 4 ? "<span class='strong-tag'>üî• STRONG</span>" : "";
        item.innerHTML = `‡§∞‡•ã: ${m.index+1} | ‡§Æ‡•à‡§ö ‡§∏‡•ç‡§ï‡•ã‡§∞: ${m.score} ${isStrong}`;
        item.onclick = () => {
            activePattern = m;
            render();
            let pred = data[m.index + 1] ? data[m.index + 1][targetC] : "??";
            document.getElementById("result").innerText = pred;
            document.getElementById("status").innerText = m.score >= 4 ? "HIGH CONFIDENCE MATCH FOUND!" : "Normal Match";
        };
        div.appendChild(item);
    });
}

function drawPatternLines(){
    const cvs = document.getElementById("mainCanvas");
    const tbl = document.getElementById("tbl");
    const ctx = cvs.getContext("2d");
    cvs.width = tbl.offsetWidth; cvs.height = tbl.offsetHeight;
    ctx.clearRect(0,0,cvs.width,cvs.height);
    
    let rect = tbl.getBoundingClientRect();
    let circles = document.querySelectorAll(".circle, .base-mark");
    if(circles.length < 2) return;
    
    ctx.strokeStyle = "rgba(0, 255, 65, 0.5)";
    ctx.lineWidth = 1.5;
    let base = document.querySelector(".base-mark").getBoundingClientRect();
    
    circles.forEach(c => {
        let r = c.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(base.left - rect.left + base.width/2, base.top - rect.top + base.height/2);
        ctx.lineTo(r.left - rect.left + r.width/2, r.top - rect.top + r.height/2);
        ctx.stroke();
    });
}

function edit(r,c,el){ data[r][c] = el.innerText.trim(); }
function addRow(){ data.push(["**","**","**","**","**","**"]); render(); }
function saveData(){ localStorage.setItem("kalyan_pro_v3", JSON.stringify(data)); alert("‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!"); }
function clearData(){ if(confirm("‡§∏‡§¨ ‡§Æ‡§ø‡§ü‡§æ ‡§¶‡•á‡§Ç?")){ localStorage.clear(); location.reload(); } }

document.getElementById("csvInput").onchange = e => {
    let fr = new FileReader();
    fr.onload = () => {
        data = fr.result.split('\n').filter(l=>l.trim()).map(l => l.replace(/\./g, ',').split(',').map(v => v.trim()));
        render();
    };
    fr.readAsText(e.target.files[0]);
};

render();
</script>
</body>
</html>
